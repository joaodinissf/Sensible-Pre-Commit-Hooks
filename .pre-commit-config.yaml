# ============================================================================
# SENSIBLE PRE-COMMIT HOOKS - VERSION 2.0
# ============================================================================
# This repository supports both pre-commit and lefthook:
# - Use lefthook for fast local development (lefthook.yml)
# - Use pre-commit for CI/CD and standardization (this file)
#
# Both configurations use the same tool settings in .pre-commit/
# ============================================================================
repos:
# ============================================================================
# PYTHON
# ============================================================================
- repo: https://github.com/hadialqattan/pycln
  rev: v2.6.0
  hooks:
  - id: pycln
    args: [--all]
    types: [python]
- repo: https://github.com/pycqa/isort
  rev: 7.0.0
  hooks:
  - id: isort
    types: [python]
- repo: https://github.com/astral-sh/ruff-pre-commit
  rev: v0.14.10
  hooks:
  - id: ruff-format
    name: ruff format
    description: Run 'ruff format' for extremely fast Python formatting
    entry: ruff format --force-exclude
    language: python
    types_or: [python, pyi, jupyter]
    args: []
    require_serial: true
  - id: ruff-check
    name: ruff check
    description: Run 'ruff check' for extremely fast Python linting
    entry: ruff check --force-exclude
    language: python
    types_or: [python, pyi, jupyter]
    args: []
    require_serial: true
# ============================================================================
# PYTHON TYPE CHECKING
# ============================================================================
# Active: pyright (fast, accurate, VS Code native)
# Active: ty (experimental v0.0.8, 10-60x faster than mypy/pyright)
# ============================================================================
# Uses system-installed tools for consistency with lefthook
- repo: local
  hooks:
  - id: pyright
    name: pyright
    entry: pyright
    language: system
    types: [python]
    pass_filenames: true
  - id: ty
    name: ty (experimental type checker)
    entry: ty check
    language: system
    types: [python]
    pass_filenames: true

# ALTERNATIVE: Unofficial pyright wrapper (automatically manages pyright installation)
# Uncomment to use wrapper instead of system pyright (no npm required)
# - repo: https://github.com/RobertCraigie/pyright-python
#   rev: v1.1.407
#   hooks:
#   - id: pyright

# ALTERNATIVE: mypy (stable type checker)
# Uncomment to use mypy instead of/in addition to pyright
# - repo: https://github.com/pre-commit/mirrors-mypy
#   rev: v1.18.2
#   hooks:
#   - id: mypy
#     types: [python]

# NOTE: pylint removed - ruff-check provides equivalent linting
# Uncomment if you need pylint-specific checks
# - repo: https://github.com/pycqa/pylint
#   rev: v3.3.8
#   hooks:
#   - id: pylint
#     types: [python]

# ============================================================================
# JAVASCRIPT/TYPESCRIPT/WEB
# ============================================================================
- repo: local
  hooks:
  - id: prettier
    name: prettier (JS/TS/JSON/CSS/etc.)
    entry: bash -lc 'npx prettier --ignore-unknown --write "$@"'
    language: system
    pass_filenames: true
    types_or:
    - astro
    - javascript
    - jsx
    - ts
    - tsx
    - json
    - css
    - scss

# ============================================================================
# RUST
# ============================================================================
- repo: local
  hooks:
  - id: rustfmt
    name: rustfmt (Rust)
    entry: rustfmt --edition 2024
    language: system
    types: [rust]
    require_serial: true
  - id: clippy
    name: clippy (Rust)
    entry: bash -c 'RUSTFLAGS="-Dwarnings" cargo clippy --all-targets --all-features'
    language: system
    types: [rust]
    pass_filenames: false

# ============================================================================
# JAVA
# ============================================================================
# Uses system-installed tools for consistency with lefthook
- repo: local
  hooks:
  - id: google-java-format
    name: Google Java Format
    entry: bash -c 'for file in "$@"; do hooks/gjfpc-hook/format.sh -i "$file"; done' --
    language: system
    types: [java]
    pass_filenames: true
  - id: pmd
    name: PMD
    entry: pmd check --no-cache -d
    language: system
    types: [java]
    pass_filenames: true
  - id: cpd
    name: CPD (Copy-Paste Detector)
    entry: cpd --minimum-tokens 50 --files
    language: system
    types: [java]
    pass_filenames: true
  - id: checkstyle
    name: Checkstyle
    entry: checkstyle -c .pre-commit/java/google_checks.xml
    language: system
    types: [java]
    pass_filenames: true

# ALTERNATIVE: Unofficial Java tools wrapper (uses Docker for PMD/Checkstyle)
# Uncomment to use wrapper instead of system tools
# - repo: https://github.com/gherynos/pre-commit-java
#   rev: v0.6.31
#   hooks:
#   - id: pmd
#   - id: cpd
#   - id: checkstyle

# ============================================================================
# MARKDOWN
# ============================================================================
- repo: https://github.com/igorshubovych/markdownlint-cli
  rev: v0.47.0
  hooks:
  - id: markdownlint-fix
    name: markdownlint-fix
    description: Fixes the style of Markdown/Commonmark files
    entry: markdownlint --fix --config .pre-commit/markdown/markdownlint.json
    language: node
    types:
    - markdown

# ============================================================================
# YAML
# ============================================================================
- repo: https://github.com/lyz-code/yamlfix
  rev: 1.19.1
  hooks:
  - id: yamlfix
    exclude: .*lock\.ya?ml$
    args: [--config-file, .pre-commit/yaml/yamlfix.toml]
    types:
    - yaml

# ============================================================================
# TOML
# ============================================================================
# Uses system-installed taplo (cargo install taplo-cli)
# Matches lefthook configuration for consistency
- repo: local
  hooks:
  - id: taplo-format
    name: taplo format (TOML)
    entry: taplo format --config .pre-commit/toml/taplo.toml
    language: system
    types: [toml]
  - id: taplo-lint
    name: taplo lint (TOML)
    entry: taplo lint --config .pre-commit/toml/taplo.toml
    language: system
    types: [toml]

# ============================================================================
# SQL
# ============================================================================
- repo: https://github.com/sqlfluff/sqlfluff
  rev: 4.0.0a2
  hooks:
  - id: sqlfluff-fix
    name: sqlfluff fix (Postgres)
    entry: sqlfluff fix --config .pre-commit/sql/.sqlfluff
    language: python
    types: [sql]
  - id: sqlfluff-lint
    name: sqlfluff lint (Postgres)
    entry: sqlfluff lint --config .pre-commit/sql/.sqlfluff
    language: python
    types:
    - sql

# ============================================================================
# SHELL SCRIPTS
# ============================================================================
- repo: local
  hooks:
  - id: shell-fmt
    name: shfmt
    description: Rewrites all shell scripts to a canonical format.
    entry: shfmt
    language: system
    types: [file, shell]
    exclude_types: [zsh]
    args:
    - -w
    - -s
    - -l
    - -i
    - '2'

# ============================================================================
# GENERAL FILE CHECKS
# ============================================================================
- repo: https://github.com/pre-commit/pre-commit-hooks
  rev: v6.0.0
  hooks:
  - id: check-yaml
  - id: end-of-file-fixer
  - id: trailing-whitespace
    exclude: \.(md|markdown)$
  - id: mixed-line-ending
    args: [--fix=lf]
  - id: detect-private-key
  - id: detect-aws-credentials
    args: [--allow-missing-credentials]
  - id: check-added-large-files
    args: [--maxkb=1000]
